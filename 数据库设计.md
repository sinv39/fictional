# 数据库设计文档

## 数据库信息
- **数据库名**: fiction
- **字符集**: utf8mb4
- **排序规则**: utf8mb4_unicode_ci
- **版本**: MySQL 8.0.20

---

## 表结构设计

### 1. 用户表 (tb_user)

存储社团成员信息

| 字段名 | 类型 | 长度 | 允许空 | 主键 | 默认值 | 说明 |
|--------|------|------|--------|------|--------|------|
| id | BIGINT | - | NO | PRI | AUTO_INCREMENT | 用户ID |
| student_id | VARCHAR | 20 | NO | UNI | - | 学号（唯一） |
| password | VARCHAR | 255 | NO | - | - | 密码（ARGON2加密） |
| real_name | VARCHAR | 50 | NO | - | - | 真实姓名 |
| college | VARCHAR | 100 | NO | - | - | 学院 |
| dormitory | VARCHAR | 50 | NO | - | - | 宿舍号 |
| phone | VARCHAR | 20 | NO | - | - | 手机号 |
| qq | VARCHAR | 20 | NO | - | - | QQ号 |
| introduction | TEXT | - | YES | - | NULL | 个人简介 |
| role | VARCHAR | 20 | NO | - | 'USER' | 角色（USER/ADMIN） |
| status | TINYINT | - | NO | - | 1 | 状态（1-正常，0-禁用） |
| create_time | DATETIME | - | NO | - | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | NO | - | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

**索引**:
- PRIMARY KEY: `id`
- UNIQUE KEY: `uk_student_id` (`student_id`)
- KEY: `idx_role` (`role`)

**建表语句**:
```sql
CREATE TABLE tb_user (
    id BIGINT AUTO_INCREMENT COMMENT '用户ID',
    student_id VARCHAR(20) NOT NULL COMMENT '学号',
    password VARCHAR(255) NOT NULL COMMENT '密码（ARGON2加密）',
    real_name VARCHAR(50) NOT NULL COMMENT '真实姓名',
    college VARCHAR(100) NOT NULL COMMENT '学院',
    dormitory VARCHAR(50) NOT NULL COMMENT '宿舍号',
    phone VARCHAR(20) NOT NULL COMMENT '手机号',
    qq VARCHAR(20) NOT NULL COMMENT 'QQ号',
    introduction TEXT COMMENT '个人简介',
    role VARCHAR(20) NOT NULL DEFAULT 'USER' COMMENT '角色（USER/ADMIN）',
    status TINYINT NOT NULL DEFAULT 1 COMMENT '状态（1-正常，0-禁用）',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (id),
    UNIQUE KEY uk_student_id (student_id),
    KEY idx_role (role)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';
```

---

### 2. 申请表 (tb_application)

存储入社申请信息

| 字段名 | 类型 | 长度 | 允许空 | 主键 | 默认值 | 说明 |
|--------|------|------|--------|------|--------|------|
| id | BIGINT | - | NO | PRI | AUTO_INCREMENT | 申请ID |
| student_id | VARCHAR | 20 | NO | - | - | 学号 |
| real_name | VARCHAR | 50 | NO | - | - | 真实姓名 |
| college | VARCHAR | 100 | NO | - | - | 学院 |
| dormitory | VARCHAR | 50 | NO | - | - | 宿舍号 |
| phone | VARCHAR | 20 | NO | - | - | 手机号 |
| qq | VARCHAR | 20 | NO | - | - | QQ号 |
| introduction | TEXT | - | YES | - | NULL | 个人简介 |
| status | VARCHAR | 20 | NO | - | 'PENDING' | 状态（PENDING/APPROVED/REJECTED） |
| apply_time | DATETIME | - | NO | - | CURRENT_TIMESTAMP | 申请时间 |
| handle_time | DATETIME | - | YES | - | NULL | 处理时间 |
| handler_id | BIGINT | - | YES | - | NULL | 处理人ID |
| reject_reason | VARCHAR | 255 | YES | - | NULL | 拒绝原因 |

**索引**:
- PRIMARY KEY: `id`
- KEY: `idx_student_id` (`student_id`)
- KEY: `idx_status` (`status`)
- KEY: `idx_apply_time` (`apply_time`)

**建表语句**:
```sql
CREATE TABLE tb_application (
    id BIGINT AUTO_INCREMENT COMMENT '申请ID',
    student_id VARCHAR(20) NOT NULL COMMENT '学号',
    real_name VARCHAR(50) NOT NULL COMMENT '真实姓名',
    college VARCHAR(100) NOT NULL COMMENT '学院',
    dormitory VARCHAR(50) NOT NULL COMMENT '宿舍号',
    phone VARCHAR(20) NOT NULL COMMENT '手机号',
    qq VARCHAR(20) NOT NULL COMMENT 'QQ号',
    introduction TEXT COMMENT '个人简介',
    status VARCHAR(20) NOT NULL DEFAULT 'PENDING' COMMENT '状态（PENDING-待审批/APPROVED-已通过/REJECTED-已拒绝）',
    apply_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '申请时间',
    handle_time DATETIME COMMENT '处理时间',
    handler_id BIGINT COMMENT '处理人ID',
    reject_reason VARCHAR(255) COMMENT '拒绝原因',
    PRIMARY KEY (id),
    KEY idx_student_id (student_id),
    KEY idx_status (status),
    KEY idx_apply_time (apply_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='申请表';
```

---

### 3. 视频表 (tb_video)

存储社团视频信息

| 字段名 | 类型 | 长度 | 允许空 | 主键 | 默认值 | 说明 |
|--------|------|------|--------|------|--------|------|
| id | BIGINT | - | NO | PRI | AUTO_INCREMENT | 视频ID |
| video_name | VARCHAR | 200 | NO | - | - | 视频名称 |
| video_path | VARCHAR | 500 | NO | - | - | MinIO存储路径 |
| file_size | BIGINT | - | NO | - | - | 文件大小（字节） |
| duration | INT | - | YES | - | NULL | 时长（秒） |
| uploader_id | BIGINT | - | NO | - | - | 上传者ID |
| uploader_name | VARCHAR | 50 | NO | - | - | 上传者姓名 |
| upload_time | DATETIME | - | NO | - | CURRENT_TIMESTAMP | 上传时间 |
| status | TINYINT | - | NO | - | 1 | 状态（1-正常，0-删除） |

**索引**:
- PRIMARY KEY: `id`
- KEY: `idx_uploader_id` (`uploader_id`)
- KEY: `idx_upload_time` (`upload_time`)

**建表语句**:
```sql
CREATE TABLE tb_video (
    id BIGINT AUTO_INCREMENT COMMENT '视频ID',
    video_name VARCHAR(200) NOT NULL COMMENT '视频名称',
    video_path VARCHAR(500) NOT NULL COMMENT 'MinIO存储路径',
    file_size BIGINT NOT NULL COMMENT '文件大小（字节）',
    duration INT COMMENT '时长（秒）',
    uploader_id BIGINT NOT NULL COMMENT '上传者ID',
    uploader_name VARCHAR(50) NOT NULL COMMENT '上传者姓名',
    upload_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '上传时间',
    status TINYINT NOT NULL DEFAULT 1 COMMENT '状态（1-正常，0-删除）',
    PRIMARY KEY (id),
    KEY idx_uploader_id (uploader_id),
    KEY idx_upload_time (upload_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='视频表';
```

---

### 4. 图片表 (tb_photo)

存储社团图片信息

| 字段名 | 类型 | 长度 | 允许空 | 主键 | 默认值 | 说明 |
|--------|------|------|--------|------|--------|------|
| id | BIGINT | - | NO | PRI | AUTO_INCREMENT | 图片ID |
| photo_name | VARCHAR | 200 | NO | - | - | 图片名称 |
| photo_path | VARCHAR | 500 | NO | - | - | MinIO存储路径 |
| file_size | BIGINT | - | NO | - | - | 文件大小（字节） |
| width | INT | - | YES | - | NULL | 图片宽度 |
| height | INT | - | YES | - | NULL | 图片高度 |
| uploader_id | BIGINT | - | NO | - | - | 上传者ID |
| uploader_name | VARCHAR | 50 | NO | - | - | 上传者姓名 |
| upload_time | DATETIME | - | NO | - | CURRENT_TIMESTAMP | 上传时间 |
| status | TINYINT | - | NO | - | 1 | 状态（1-正常，0-删除） |

**索引**:
- PRIMARY KEY: `id`
- KEY: `idx_uploader_id` (`uploader_id`)
- KEY: `idx_upload_time` (`upload_time`)

**建表语句**:
```sql
CREATE TABLE tb_photo (
    id BIGINT AUTO_INCREMENT COMMENT '图片ID',
    photo_name VARCHAR(200) NOT NULL COMMENT '图片名称',
    photo_path VARCHAR(500) NOT NULL COMMENT 'MinIO存储路径',
    file_size BIGINT NOT NULL COMMENT '文件大小（字节）',
    width INT COMMENT '图片宽度',
    height INT COMMENT '图片高度',
    uploader_id BIGINT NOT NULL COMMENT '上传者ID',
    uploader_name VARCHAR(50) NOT NULL COMMENT '上传者姓名',
    upload_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '上传时间',
    status TINYINT NOT NULL DEFAULT 1 COMMENT '状态（1-正常，0-删除）',
    PRIMARY KEY (id),
    KEY idx_uploader_id (uploader_id),
    KEY idx_upload_time (upload_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='图片表';
```

---

### 5. 大事记表 (tb_event)

存储社团大事记

| 字段名 | 类型 | 长度 | 允许空 | 主键 | 默认值 | 说明 |
|--------|------|------|--------|------|--------|------|
| id | BIGINT | - | NO | PRI | AUTO_INCREMENT | 大事记ID |
| title | VARCHAR | 200 | NO | - | - | 标题 |
| content | TEXT | - | NO | - | - | 内容 |
| publisher_id | BIGINT | - | NO | - | - | 发布者ID |
| publisher_name | VARCHAR | 50 | NO | - | - | 发布者姓名 |
| create_time | DATETIME | - | NO | - | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | NO | - | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |
| status | TINYINT | - | NO | - | 1 | 状态（1-正常，0-删除） |

**索引**:
- PRIMARY KEY: `id`
- KEY: `idx_publisher_id` (`publisher_id`)
- KEY: `idx_create_time` (`create_time`)

**建表语句**:
```sql
CREATE TABLE tb_event (
    id BIGINT AUTO_INCREMENT COMMENT '大事记ID',
    title VARCHAR(200) NOT NULL COMMENT '标题',
    content TEXT NOT NULL COMMENT '内容',
    publisher_id BIGINT NOT NULL COMMENT '发布者ID',
    publisher_name VARCHAR(50) NOT NULL COMMENT '发布者姓名',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    status TINYINT NOT NULL DEFAULT 1 COMMENT '状态（1-正常，0-删除）',
    PRIMARY KEY (id),
    KEY idx_publisher_id (publisher_id),
    KEY idx_create_time (create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='大事记表';
```

---

### 6. 封面配置表 (tb_cover_config)

存储网站封面配置

| 字段名 | 类型 | 长度 | 允许空 | 主键 | 默认值 | 说明 |
|--------|------|------|--------|------|--------|------|
| id | BIGINT | - | NO | PRI | AUTO_INCREMENT | 配置ID |
| cover_type | VARCHAR | 50 | NO | UNI | - | 封面类型（HOME/INTRO） |
| cover_path | VARCHAR | 500 | NO | - | - | MinIO存储路径 |
| introduction | TEXT | - | YES | - | NULL | 社团介绍文字（仅INTRO类型使用） |
| update_time | DATETIME | - | NO | - | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |
| updater_id | BIGINT | - | YES | - | NULL | 更新者ID |

**索引**:
- PRIMARY KEY: `id`
- UNIQUE KEY: `uk_cover_type` (`cover_type`)

**建表语句**:
```sql
CREATE TABLE tb_cover_config (
    id BIGINT AUTO_INCREMENT COMMENT '配置ID',
    cover_type VARCHAR(50) NOT NULL COMMENT '封面类型（HOME-主页封面/INTRO-介绍封面）',
    cover_path VARCHAR(500) NOT NULL COMMENT 'MinIO存储路径',
    introduction TEXT COMMENT '社团介绍文字（仅INTRO类型使用）',
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    updater_id BIGINT COMMENT '更新者ID',
    PRIMARY KEY (id),
    UNIQUE KEY uk_cover_type (cover_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='封面配置表';
```

---

## 初始化数据

### 1. 初始管理员账户

```sql
-- 注意：密码需要使用ARGON2算法加密后插入，这里的密码是示例
INSERT INTO tb_user (student_id, password, real_name, college, dormitory, phone, qq, introduction, role) 
VALUES ('admin', '$argon2id$v=19$m=65536,t=3,p=4$...', '系统管理员', '计算机学院', '-', '13800000000', '0', '系统初始管理员', 'ADMIN');
```

### 2. 初始封面配置

```sql
-- 插入默认封面配置
INSERT INTO tb_cover_config (cover_type, cover_path, introduction) 
VALUES 
('HOME', 'default/home-cover.jpg', NULL),
('INTRO', 'default/intro-cover.jpg', '中国地质大学科幻界成立于2020年，是一个充满创意和想象力的学生社团。我们致力于传播科幻文化，组织各类科幻活动...');
```

---

## 数据字典说明

### 用户角色 (role)
- `USER`: 普通成员
- `ADMIN`: 管理员

### 申请状态 (status in tb_application)
- `PENDING`: 待审批
- `APPROVED`: 已通过
- `REJECTED`: 已拒绝

### 封面类型 (cover_type)
- `HOME`: 主页封面
- `INTRO`: 社团介绍封面

### 通用状态 (status in other tables)
- `1`: 正常/启用
- `0`: 删除/禁用

---

## ER 关系说明

1. **用户表 (tb_user)** 与 **申请表 (tb_application)**: 一对多关系（一个管理员可以处理多个申请）
2. **用户表 (tb_user)** 与 **视频表 (tb_video)**: 一对多关系（一个用户可以上传多个视频）
3. **用户表 (tb_user)** 与 **图片表 (tb_photo)**: 一对多关系（一个用户可以上传多张图片）
4. **用户表 (tb_user)** 与 **大事记表 (tb_event)**: 一对多关系（一个用户可以发布多条大事记）

---

## 数据备份建议

1. 定期备份数据库（建议每天一次）
2. MinIO 存储的文件也需要定期备份
3. 保留至少 30 天的备份数据
4. 重要操作前进行手动备份

